<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">src/beloader.js | BeLoader | Highly customizable and lightweight loader based on dynamic imports with splash screen, animated blocks and more</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<link rel="stylesheet" href="./inject/css/0-styles.css"><script src="./inject/script/0-docs.js"></script><meta name="description" content="Highly customizable and lightweight assets loader based on dynamic imports"><meta property="twitter:card" content="summary"><meta property="twitter:title" content="BeLoader | Highly customizable and lightweight loader based on dynamic imports with splash screen, animated blocks and more"><meta property="twitter:description" content="Highly customizable and lightweight assets loader based on dynamic imports"></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./" style="display: flex; align-items: center;"><img src="./image/brand_logo.png" style="width:34px;"></a>
  <a href="./manual/index.html" data-ice="manualHeaderLink">Manual</a>
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  <a href="test.html" data-ice="testLink">Test</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/beloader/beloader.git"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/beloader.js~Beloader.html">Beloader</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/queueitem.js~QueueItem.html">QueueItem</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#core">core</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/core/AbstractEventManager.js~AbstractEventManager.html">AbstractEventManager</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/core/AbstractLoader.js~AbstractLoader.html">AbstractLoader</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/core/AbstractPlugin.js~AbstractPlugin.html">AbstractPlugin</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#events">events</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/events/BeloaderEvent.js~BeloaderEvent.html">BeloaderEvent</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-abort">abort</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-afterprocess">afterprocess</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-beforeprocess">beforeprocess</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-error">error</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-load">load</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-loadend">loadend</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-loadstart">loadstart</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-loadstarted">loadstarted</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-progress">progress</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-ready">ready</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-readystatechange">readystatechange</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-timeout">timeout</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://developer.mozilla.org/en-US/docs/Web/API/ProgressEvent">ProgressEvent</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#loaders">loaders</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/loaders/CustomLoader.js~CustomLoader.html">CustomLoader</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/loaders/FontLoader.js~FontLoader.html">FontLoader</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/loaders/ImageLoader.js~ImageLoader.html">ImageLoader</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/loaders/JsonLoader.js~JsonLoader.html">JsonLoader</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/loaders/NoneLoader.js~AbstractLoader.html">AbstractLoader</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/loaders/PluginLoader.js~PluginLoader.html">PluginLoader</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/loaders/ScriptLoader.js~ScriptLoader.html">ScriptLoader</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/loaders/StylesheetLoader.js~StylesheetLoader.html">StylesheetLoader</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#types">types</a><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-BeloaderOptions">BeloaderOptions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-BeloaderProgress">BeloaderProgress</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-Loader">Loader</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-Plugin">Plugin</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-QueueItemOptions">QueueItemOptions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://liqueurdetoile.github.io/DotObjectArray/">DotObjectArray</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement">HTMLElement</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest">XMLHttpRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Objets_globaux/Date/now">timestamp</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/beloader.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">/**
*  @file beloader.js
*  @author Liqueur de Toile &lt;contact@liqueurdetoile.com&gt;
*  @licence AGPL-3.0 {@link https://github.com/liqueurdetoile/beloader/blob/master/LICENSE}
*/

import &apos;core/publicpath&apos;;
import &apos;es6-promise/auto&apos;;
import ObjectArray from &apos;dot-object-array&apos;;
import uniqid from &apos;uniqid&apos;;
import AbstractEventManager from &apos;core/AbstractEventManager&apos;;
import AbstractPlugin from &apos;core/AbstractPlugin&apos;;
import QueueItem from &apos;queueitem&apos;;

/**
*  Highly customizable and lightweight assets loader
*
*  You can create as many loaders instance as needed. Inside one instance, you can access
*  specific loaders or functionnalities and order loading sequence with the use
*  of defer or awaiting options, see {@link Beloader#fetch}.
*
*  @version 1.0.0
*  @since 1.0.0
*  @author Liqueur de Toile &lt;contact@liqueurdetoile.com&gt;
*  @extends {AbstractEventManager}
*
*  @example
*  var loader = new Beloader();
*
*  // Display a text only when font is ready to avoit FOUT
*  // It relies on webfontloader
*  loader.fetch(&apos;font&apos;, {
*    webfont: {
*      google: {
*        families: [&apos;Droid Sans&apos;, &apos;Droid Serif&apos;]
*      }
*    }
*  }).then(function() {
*    document.body.innerHTML += &apos;&lt;div style=&quot;font-family:\&apos;Droid Sans\&apos;&quot;&gt;Fixture&lt;/div&gt;&apos;;
*  });
*
*  // ********************
*  // Load external libraries and only run custom script when they&apos;re loaded
*  // *********************
*
*  // Example with defer
*  // Not the best use case because the two external libraries don&apos;t depend on each other
*  // Lodash loading will not resolve until elementify resolved
*  loader.fetch(&apos;script&apos;, {
*    url: &apos;https://cdn.jsdelivr.net/npm/elementify@latest&apos;,
*    defer: true;
*  });
*
*  loader.fetch(&apos;script&apos;, {
*    url: &apos;https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.5/lodash.min.js&apos;,
*    defer: true;
*  });
*
*  loader.fetch(&apos;script&apos;, {
*   url: &apos;myscript&apos;,
*   defer: true
*  });
*
*  // Example with awaiting
*  // More suitable to optimize loading
*  loader.fetch(&apos;script&apos;, {
*   url: &apos;myscript&apos;,
*   awaiting: [&apos;elementify&apos;, &apos;lodash&apos;]
*  });
*
*  loader.fetch(&apos;script&apos;, {
*    id: &apos;elementify&apos;,
*    url: &apos;https://cdn.jsdelivr.net/npm/elementify@latest&apos;
*  });
*
*  loader.fetch(&apos;script&apos;, {
*    id: &apos;lodash&apos;,
*    url: &apos;https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.5/lodash.min.js&apos;
*  });
*
*/
export default class Beloader extends AbstractEventManager {
  /**
  *  Beloader constructor
  *
  *  @version 1.0.0
  *  @since 1.0.0
  *  @author Liqueur de Toile &lt;contact@liqueurdetoile.com&gt;
  *
  *  @param {BeloaderOptions}  options Global options for Beloader instance
  *  @returns {Beloader} Beloader instance
  */
  constructor(options = {}) {

    super(options.on);
    delete options.on;

    /**
    *  List of queued items in Beloader instance
    *
    *  @since 1.0.0
    *  @type {Array}
    *
    */
    this._items = [];

    /**
    *  List of named queued items in Beloader instance
    *
    *  @since 1.0.0
    *  @type {Object}
    */
    this._awaitables = {};

    /**
    *  Active Plugins list
    *
    *  @since 1.0.0
    *  @type {DotObjectArray}
    */
    this._plugins = new ObjectArray();

    // Import plugins set in options
    if (options.plugins) {
      let plugins = {};

      if (typeof options.plugins === &apos;string&apos;) options.plugins = [options.plugins];

      if (options.plugins instanceof Array) {
        options.plugins.forEach(plugin =&gt; {
          if (typeof plugin === &apos;string&apos;) {
            plugins[plugin] = {
              type: &apos;plugin&apos;,
              name: plugin
            };
          } else {
            if (plugin.name) {
              plugins[plugin.name] = {
                type: &apos;plugin&apos;,
                name: plugin.name,
                url: plugin.url
              };
            } else {
              plugins[Object.keys(plugin)[0]] = {
                type: &apos;plugin&apos;,
                name: Object.keys(plugin)[0],
                url: Object.values(plugin)[0]
              };
            }
          }
        });

        this.ready = this.fetchAll(plugins);
      } else throw new TypeError(&apos;Beloader: Plugins list must be an array&apos;);
    }

    /**
    *  Options for the Beloader instance. See {@link Beloader#constructor}
    *
    *  @since 1.0.0
    *  @type {DotObjectArray}
    */
    this.options = new ObjectArray(options);
    this.options.define(&apos;autoprocess&apos;, true);
    this.options.define(&apos;async&apos;, true);
    this.options.define(&apos;defer&apos;, false);
    this.options.define(&apos;cache&apos;, true);
    this.options.define(&apos;fallbackSync&apos;, true);

    /**
    *  Progress statistics for the Beloader instance.
    *
    *  @since 1.0.0
    *  @type {BeloaderProgress}
    */
    this.progress = new ObjectArray({
      items: {
        total: 0,
        waiting: 0,
        pending: 0,
        processed: 0,
        loaded: 0,
        error: 0,
        abort: 0,
        timeout: 0,
        ready: 0
      },
      loading: {
        complete: 0,
        elapsed: 0,
        loaded: 0,
        rate: 0
      }
    });
  }

  /**
  *  Add an item to the loading queue and return a promise
  *
  *  An item is resolved (or failed) under several conditions :
  *  - Item have been loaded
  *  - Item is ready (webfontloader for instance)
  *  - If deferred, all previously defferred items in the queue are resolved
  *  - If awaiting items, all required items are resolved
  *
  *  Supported types relies on loaders that may accept/require specific options :
  *  - `font`, `webfont` : {@link FontLoader} - Async only
  *  - `css`, `style`, `styles`, `stylesheet` : {@link StylesheetLoader}
  *  - `js`, `script`, `javascript`, `ecmascript` : {@link ScriptLoader}
  *  - `json` : {@link JsonLoader} - Async only
  *  - `img`, `image` : {@link ImageLoader}
  *  - `plugin` : {@link PluginLoader}
  *  - `none` : Beloader will simulate
  *  a loading sequence that is ever successfull. It can be used
  *  with awaiting to create side-effect and trigger callback
  *
  *  Any other value will throw an error, except if a custom loader callback
  *  is provided in `options.loader`.
  *
  *  @version 1.0.0
  *  @since 1.0.0
  *  @author Liqueur de Toile &lt;contact@liqueurdetoile.com&gt;
  *
  *  @param {!String} type  Type of item to load (see above)
  *  @param {String|QueueItemOptions} [options]
  *  If a string is provided, Beloader will use it as a value
  *  for the `url` option.
  */
  fetch(type, options = {}) {
    let item;

    if (typeof options === &apos;string&apos;) options = {url: options};
    options = new ObjectArray(options);
    options.define(&apos;autoprocess&apos;, this.options.pull(&apos;autoprocess&apos;));
    options.define(&apos;async&apos;, this.options.pull(&apos;async&apos;));
    options.define(&apos;defer&apos;, this.options.pull(&apos;defer&apos;));
    options.define(&apos;cache&apos;, this.options.pull(&apos;cache&apos;));
    options.define(&apos;fallbackSync&apos;, this.options.pull(&apos;fallbackSync&apos;));
    options.define(&apos;xhr&apos;, this.options.pull(&apos;xhr&apos;));
    options.define(&apos;loader&apos;, this.options.pull(&apos;loader&apos;));
    // Append a unique hash to url if cache set to false
    if (options.data.url &amp;&amp; !options.data.cache) {
      if (options.data.url.indexOf(&apos;?&apos;) &gt; 0) options.data.url += &apos;&amp;&apos; + uniqid();
      else options.data.url += &apos;?&apos; + uniqid();
    }

    item = new QueueItem(type, this, options);
    this._items.push(item);
    if (options.data.id) this._awaitables[options.data.id] = false;
    this.fire(&apos;itemadded&apos;, this, item);

    this.progress.push(&apos;items.total&apos;, this._items.length);
    this.progress.push(&apos;items.waiting&apos;, this.progress.pull(&apos;items.waiting&apos;) + 1);

    return item;
  }

  /**
  *  Convenient method for bulk loading
  *
  *  provided object must have id as keys and provide the type
  *  parameter as an option value.
  *
  *  @version 1.0.0
  *  @since 1.0.0
  *  @author Liqueur de Toile &lt;contact@liqueurdetoile.com&gt;
  *
  *  @param {Object} items Items to load
  *  @returns {QueueItem[]} Items loaded
  *  The array expose a promise property that is resolved
  *  with Promise.all
  *  @see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/all
  *  @example
  *  var loader = new Beloader({
  *   defer: true // load in same order than declared
  *  });
  *
  *  loader.fetchAll({
  *   elementify: {
  *     type: &apos;js&apos;,
  *     url: &apos;https://cdn.jsdelivr.net/npm/elementify@latest&apos;
  *   },
  *   Droid: {
  *     type: &apos;font&apos;,
  *     webfont: {
  *       google: {
  *         families: [&apos;Droid Sans&apos;, &apos;Droid Serif&apos;]
  *       }
  *     }
  *   }).promise.then((...items) =&gt; start());
  *
  */
  fetchAll(items) {
    let queuedItems = [];
    let promises = [];

    items = new ObjectArray(items);
    items.forEach(function (options, id) {
      let item, type = options.type;

      delete options.type;
      options.id = id;
      item = this.fetch(type, options);
      queuedItems.push(item);
      promises.push(item.promise);
    }.bind(this));

    queuedItems.promise = Promise.all(promises);
    return queuedItems;
  }

  /**
  *  Process all items in the queue that are waiting.
  *  Obviously, it must be used with `autoprocess` set to `false`
  *
  *  @version 1.0.0
  *  @since 1.0.0
  *  @author Liqueur de Toile &lt;contact@liqueurdetoile.com&gt;
  */
  process() {
    this._items.forEach(item =&gt; {
      /* istanbul ignore else */
      if (item.state.waiting) item.process();
    });
  }

  /**
  *  Import plugin into Beloader instance and extends
  *  native method of Beloader, QueueItem and Loader
  *  instances with plugin instance.
  *
  *  The plugin will extends an {@link AbtractPlugin} instance and
  *  therefor will be able to throw events.
  *
  *  A plugin will only be available in QueueItem and Loader
  *  instances created __after__ plugin import.
  *
  *  The `init` method of a plugin is automatically
  *  called after plugin import.
  *
  *  @version 1.0.0
  *  @since 1.0.0
  *  @author Liqueur de Toile &lt;contact@liqueurdetoile.com&gt;
  *
  *  @param {string} name Name for the plugin
  *  @param {Object|Function} Plugin Plugin constructor or singleton
  *  @param {Object} [options={}] Plugin&apos;s options passed to constructor
  *  @throws {Error}  If unable to load plugin
  */
  pluginize(name, Plugin, options = {}) {
    let plugin = AbstractPlugin;

    options = new ObjectArray(options);
    options.push(&apos;name&apos;, name);
    options.define(&apos;alias&apos;, options.data.name);

    try {
      if (Plugin instanceof AbstractPlugin) {
        plugin = new Plugin(this, options);
        this._plugins.push(name, plugin);
      } else {
        plugin = new AbstractPlugin(this, options);
        if (Plugin instanceof Function) Plugin = new Plugin();
        for (let p in Plugin) {
          /* istanbul ignore else */
          if (Plugin.hasOwnProperty(p)) plugin[p] = Plugin[p];
        }
        this._plugins.push(name, plugin);
      }
      /* istanbul ignore else */
      if (plugin.init instanceof Function) plugin.init(options);
      /** @ignore */
      /* istanbul ignore else */
      this[options.data.alias] = plugin;
    } catch (e) {
      throw new Error(&apos;Unable to pluginize : &apos; + name + &apos; [&apos; + e + &apos;]&apos;);
    }
  }

  /**
  *  loadstart built-in callback
  *
  *  @version 1.0.0
  *  @since 1.0.0
  *  @author Liqueur de Toile &lt;contact@liqueurdetoile.com&gt;
  *  @listens {loadstart}
  *  @emits {beforeprocess}
  */
  _loadstart() {
    if (!this.progress.has(&apos;loading.start&apos;)) {
      this.fire(&apos;beforeprocess&apos;, this);
      this.progress.push(&apos;loading.start&apos;, +new Date());
    }
    this.progress.data.items.waiting -= 1;
    this.progress.data.items.pending += 1;
  }

  /**
  *  progress built-in callback
  *
  *  @version 1.0.0
  *  @since 1.0.0
  *  @author Liqueur de Toile &lt;contact@liqueurdetoile.com&gt;
  *  @listens {progress}
  */
  _progress() {
    this._updateProgress();
  }

  /**
  *  load built-in callback
  *
  *  @version 1.0.0
  *  @since 1.0.0
  *  @author Liqueur de Toile &lt;contact@liqueurdetoile.com&gt;
  *  @listens {load}
  */
  _load() {
    this.progress.data.items.loaded += 1;
  }

  /**
  *  error built-in callback
  *
  *  @version 1.0.0
  *  @since 1.0.0
  *  @author Liqueur de Toile &lt;contact@liqueurdetoile.com&gt;
  *  @listens {error}
  */
  _error() {
    this.progress.data.items.error += 1;
  }

  /**
  *  abort built-in callback
  *
  *  @version 1.0.0
  *  @since 1.0.0
  *  @author Liqueur de Toile &lt;contact@liqueurdetoile.com&gt;
  *  @listens {abort}
  */
  _abort() {
    this.progress.data.items.abort += 1;
  }

  /**
  *  timeout built-in callback
  *
  *  @version 1.0.0
  *  @since 1.0.0
  *  @author Liqueur de Toile &lt;contact@liqueurdetoile.com&gt;
  *  @listens {timeout}
  */
  _timeout() {
    this.progress.data.items.timeout += 1;
  }

  /**
  *  loadend built-in callback
  *
  *  @version 1.0.0
  *  @since 1.0.0
  *  @author Liqueur de Toile &lt;contact@liqueurdetoile.com&gt;
  *  @listens {loadend}
  *  @emits {ready}
  *  @emits {afterprocess}
  */
  _loadend() {
    let previousDeferResolved = true;

    // Resolve item or defer resolving
    this._items.forEach(item =&gt; {
      // Resolvable except if deferred and previous deffered not solved
      let resolvable = item.defer ? previousDeferResolved : true;

      // Check dependencies and update resolvable if dependencies not loaded
      if (item.awaiting) {
        item.awaiting.forEach(function (dependency) {
          if (!this._awaitables[dependency]) resolvable = false;
        }.bind(this));
      }

      // Resolve item
      if (item.state.processed &amp;&amp; !item.state.resolved &amp;&amp; resolvable) {
        // Update progress
        this.progress.data.items.pending -= 1;
        this.progress.data.items.processed += 1;
        this._updateProgress();
        item.state.resolved = true;
        if (item.state.loaded) {
          item._resolve(item);
          item.state.ready = true;
          item.fire(&apos;ready&apos;, item);
          this.progress.data.items.ready += 1;
        } else {
          item._reject(item);
        }
      }

      // Update previous defer
      if (item.defer &amp;&amp; !item.state.processed) previousDeferResolved = false;
    });

    // After event
    if (this.progress.data.items.processed === this.progress.data.items.total) {
      this.fire(&apos;afterprocess&apos;, this);
      this.progress.push(&apos;loading.complete&apos;, 100);
      this.progress.push(&apos;loading.end&apos;, +new Date());
      this.progress.push(&apos;loading.elapsed&apos;, this.progress.data.loading.end - this.progress.data.loading.start);
    }
  }

  /**
  *  Update loading progress statistics
  *
  *  @version 1.0.0
  *  @since 1.0.0
  *  @author Liqueur de Toile &lt;contact@liqueurdetoile.com&gt;
  */
  _updateProgress() {
    let loaded = 0, total = 0, elapsed;

    elapsed = +new Date() - this.progress.data.loading.start;
    this._items.forEach(function (item) {
      loaded += item.progress.data.loaded;
      total += item.progress.data.total;
    });

    this.progress.push(&apos;loading.elapsed&apos;, elapsed); // milliseconds
    this.progress.push(&apos;loading.loaded&apos;, loaded); // Bytes
    this.progress.push(&apos;loading.rate&apos;, loaded / elapsed * 1000); // Bytes/s
    /* istanbul ignore else */
    if (total) {
      this.progress.push(&apos;loading.total&apos;, total); // Bytes
      this.progress.push(&apos;loading.complete&apos;, loaded / total * 100); // Bytes
    }
  }
}

export {Beloader};
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.0.4)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
